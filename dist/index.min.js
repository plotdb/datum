!function(){var n,N=function(n){return null==n&&(n={}),this instanceof N?(this._sep=n.sep||"-",Array.isArray(n)||n.body?this.from(n):n.data?this.from(n.data):this.clear(),this):n instanceof N?n:new N(n)},t={clear:function(){return this._d={h:[],b:[],n:""}},clone:function(){return new N(this.asSheet())},format:function(n){return!n||!Array.isArray(n)||n[0]&&!Array.isArray(n[0])?"db":n instanceof N?"datum":"sheet"},_dedup:function(n){var t={};return n=n.map(function(n){for(;t[n];)n=n+"("+t[n]+++")";return t[n]=1,n})},from:function(t){var r,n,e,i,u=this;return null==t&&(t={}),this.clear(),t instanceof N?this._d=JSON.parse(JSON.stringify(t._d)):"sheet"===this.format(t)?(t=JSON.parse(JSON.stringify(t))).map(function(n,t){return 0===t?u._d.h=n:u._d.b.push(n)}):(t=JSON.parse(JSON.stringify(t)),n=Array.isArray(t)?[function(){var n=[];for(r in t[0]||{})n.push(r);return n}(),t]:[t.head,t.body,t.name],e=n[0],i=n[1],this._d.n=n[2]||"",this._d.h=e,this._d.b=i.map(function(t){return Array.isArray(t)?t:e.map(function(n){return t[n]})})),this._d.h=this._dedup(this._d.h),this},asSheet:function(){return JSON.parse(JSON.stringify([this._d.h].concat(this._d.b)))},asDb:function(){var r;return this._d.h=r=this._dedup(this._d.h),JSON.parse(JSON.stringify({name:this._d.n,head:this._d.h,body:this._d.b.map(function(n){return Object.fromEntries(n.map(function(n,t){return[r[t],n]}))})}))},name:function(){return this._d.n||""},head:function(){return this._d.h},body:function(){return this._d.b},sep:function(n){return arguments.length?this._sep=n:this._sep},concat:function(){var n,t,r,e,i,u=[this].concat(Array.from(arguments).map(function(n){return N.from(n)})),o=[];for(u.map(function(n){return o=o.concat(n.head())}),o=Array.from(new Set(o)),n=[],t=0,r=u.length;t<r;++t)e=[u[e=t].head(),u[e].body()],i=e[0],n=n.concat(e[1].map(a));return this._d.h=o,this._d.b=n,this;function a(t,n){return o.map(function(n){if(~(n=i.indexOf(n)))return t[n]})}},shrink:function(n){var r,t=n.cols,n=n.keep,t=[!(null!=n&&!n),t],e=t[0],i=t[1];return i=Array.isArray(i)?i:[i],r=this._d.h.map(function(n,t){return!e==!(n=k(n,i))||!e&&!n?t:-1}),this._d.h=this._d.h.filter(function(n,t){return k(t,r)}),this._d.b=this._d.b.map(function(n){return n.filter(function(n,t){return k(t,r)})}),this},rehead:function(t){return this._d.h=this._dedup(this._d.h.map(function(n){return t[n]||n})),this},split:function(n){var t,r,e,i,u,o,a,f=n.col,n=JSON.parse(JSON.stringify(this._d)),s=[n.h,{},[]],c=s[0],h=s[1],p=s[2];if(!~(t=c.indexOf(f)))return this.clone();for(c.splice(t,1),r=0,e=(s=n.b).length;r<e;++r)(h[u=(i=s[r])[t]]||(h[u]=[])).push(i),i.splice(t,1);for(o in h)a=h[o],p.push(new N({head:c,body:a,name:(this._d.n?this._d.n+"/":"")+o}));return p},pivot:function(n){var t,r=(n=null==n?{}:n).col,e=n.joinCols;return null==(t=n.simpleHead)&&(t=!1),n=(n=this.split({col:r})).map(function(n){return n.shrink({cols:r,keep:!1})}),t=N.join({ds:n,joinCols:e,simpleHead:t}),this.from(t),this},join:function(){var r,f,e,t,i,n,u,o,a,s,c,h,p,l,d,m,y,_,b,g,v=Array.from(arguments),O=v.filter(function(n){return n&&(n.joinCols||n.ds)})[0]||{},S=Array.isArray(O.ds)?O.ds:v;for(S=S.map(function(n){return n instanceof N?n:Array.isArray(n)||n.body?N.from(n):null}).filter(function(n){return n}),this instanceof N&&(S=[this].concat(S)),r=S[0].sep(),f=O.joinCols,e=O.simpleHead,t=S.map(function(n){return n._d.h}),v=S.map(function(n){return n._d.b}),n=(i=S.map(function(n,t){return n.name()||t+1+""})).map(function(n){return n.split(r)}),u=-1,a=n[o=0].length;o<a;++o){for(s=o,c=1,h=n.length;c<h;++c)if(n[c][s]!==n[0][s]){u=s;break}if(0<=u)break}for(l in i=u<0?S.map(function(n,t){return t+1+""}):n.map(function(n){return n.slice(u).join(r)}),p={},t.map(function(n){return n.map(function(n){return p[n]=(p[n]||0)+1})}),f=f||function(){var n=[];for(l in t)n.push(l);return n}().filter(function(n){return t[n]===t.length}),d=function(n,t){return e?n:1<p[t]?n+""+r+t:t},m=t.map(function(n,t){return Object.fromEntries(n.map(function(n){return[n,k(n,f)?n:d(i[t],n)]}))}),O=t.map(function(n,t){return n.filter(function(n){return!k(n,f)}).map(function(n){return d(i[t],n)})}),y=[f].concat(O).reduce(function(n,t){return n.concat(t)},[]),_={},v.map(function(n,o){var a=t[o];return n.map(function(t){for(var n,r={},e=JSON.stringify(Object.fromEntries(f.map(function(n){return[n,t[a.indexOf(n)]]}))),i=0,u=a.length;i<u;++i)n=i,r[m[o][a[n]]]=t[n];return(_[e]||(_[e]=[])).push(r)})}),b=[],_)g=_[l],b.push(g.reduce(A,{}));return b=b.map(function(t){return y.map(function(n){return t[n]})}),N.from({head:y,body:b,name:S[0].name()||""});function A(n,t){return w(n,t)}},unpivot:function(n){var t,e,i,u=this,o=(n=null==n?{}:n).cols,a=n.name,f=n.order;return o=Array.isArray(o)?o:[o],o=this._d.h.filter(function(n){return!k(n,o)}),a=a||"item",null==f&&(f=0),t=this._sep,e=this._d.b,i=this._d.h.filter(function(n){return!k(n,o)}).map(function(n){return n.split(t)}),n=Array.from(new Set(i.map(function(n){return n[f]}))).map(function(r){o.map(function(n){return[n,n]});var n=i.filter(function(n){return n[f]===r}).map(function(n){return[n.join(t),n.filter(function(n,t){return t!==f}).join(t)||"value"]});return N.from({name:u.name(),head:o.concat([a],n.map(function(n){return n[1]})),body:e.map(function(t){return o.map(function(n){return t[u._d.h.indexOf(n)]}).concat([r],n.map(function(n){return t[u._d.h.indexOf(n[0])]}))})})}),n=N.concat(n),this._d=n._d,this},group:function(n){var r,u,o,t,e,a=this,i=(n=null==n?{}:n).cols,f=n.groupFunc,s=n.aggregator||{},c={};for(e in i=Array.isArray(i)?i:[i],(r=this._d.h.map(function(n,t){return k(n,i)||null===s[n]?-1:t}).filter(function(n){return 0<=n})).map(function(n){return c[n]=s[a._d.h[n]]}),u=i.map(function(n){return a._d.h.indexOf(n)}),n=Array.from(new Set(this._d.b.map(function(t){return JSON.stringify(Object.fromEntries(u.map(function(n){return[a._d.h[n],t[n]]})))}))),o={},n.map(function(t){var n,r,e,i,u=JSON.parse(t);if("function"==typeof f)n=f(u);else for(e in r=f||{},n={},u)i=u[e],n[e]="function"==typeof r[e]?r[e](i):i;return(Array.isArray(n)?n:[n]).map(function(n){return n=JSON.stringify(n),o[n]||(o[n]=new Set),o[n].add(t)})}),t=[],o)t.push(e);return n=t.map(function(t){var e,i=Array.from(o[t]);return t=JSON.parse(t),i=i.map(function(r){return r=JSON.parse(r),a._d.b.filter(function(t){return!u.filter(function(n){return t[n]!==r[a._d.h[n]]}).length})}).reduce(function(n,t){return n.concat(t)},[]),e=[],u.map(function(n){return e.push(t[a._d.h[n]])}),r.map(function(t,n){var r=i.map(function(n){return n[t]});return e.push(c[t]?c[t](r):r.length)}),e}),this.from({name:this._d.n,head:i.concat(r.map(function(n){return a._d.h[n]})),body:n}),this},trim:function(){var r=this._d.b.filter(function(n){return n.filter(function(n){return!(""===n||null===n||null==n)}).length}),e=this._d.h.map(function(n,t){return!r.filter(function(n){return!(""===n[t]||null===n[t]||null==n[t])}).length});return this._d.h=this._d.h.filter(function(n,t){return!e[t]}),this._d.b=r.map(function(n){return n.filter(function(n,t){return!e[t]})}),this},transpose:function(){var t=[this._d.h].concat(this._d.b);return t=this._d.h.map(function(n,r){return t.map(function(n,t){return n[r]})}),this._d.h=t.splice(0,1)[0],this._d.b=t,this}};for(n in N.prototype=w(Object.create(Object.prototype),t),N.from=function(n){return n instanceof N?n.clone():new N(n)},N.format=t.format,N.join=function(n){return(new N).join(n)},N.concat=function(n){var t;return n=1<arguments.length?Array.from(arguments):n,(t=N.from(n[0])).concat.apply(t,n.slice(1)),t},N.agg={average:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)/(n.length||1)},sum:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)},count:function(n){return n.length},first:function(n){return n[0]||""}},t)N[n]||function(n,u){N[n]=function(n){for(var t,r=[],e=1,i=arguments.length;e<i;++e)r.push(arguments[e]);return t=r,n="datum"===N.format(n)?n:N.from(n),u.apply(n,t)}}(n,t[n]);function k(n,t){for(var r=-1,e=t.length>>>0;++r<e;)if(n===t[r])return!0;return!1}function w(n,t){var r,e={}.hasOwnProperty;for(r in t)e.call(t,r)&&(n[r]=t[r]);return n}"undefined"!=typeof module&&null!==module?module.exports=N:"undefined"!=typeof window&&null!==window&&(window.datum=N),N.type={R:function(n){var t=(t=(n=null==n?{}:n).data.filter(function(n){return!(!n||""===(n+"").trim())})).filter(function(n){return!isNaN(parseFloat(n))}).length/t.length;return t=(n=N.type.O(n))===t||.9<n?.99*n:t},O:function(n){var t,r,e,i,u,o,a;for((t=[].concat((n=null==n?{}:n).data)).sort(function(n,t){return t-n}),r={},e=1,i=t.length;e<i;++e)u=e,isNaN(t[u])||isNaN(t[u-1])?r[t[u]>t[u-1]?t[u]+":"+t[u-1]:t[u-1]+":"+t[u]]=!0:o=t[u]-t[u-1],r[o]=!0;return 1/(function(){var n=[];for(a in r)n.push(a);return n}().filter(function(n){return"0"!==n}).length||2)},N:function(n){var t=1-N.type.R(n=null==n?{}:n);return t=.85<(n=N.type.C(n))?.99*n:t},C:function(n){var t;return null==n&&(n={}),t=(t=0<(t=1-(0<(t=Array.from(new Set(n.data)).length-2)?t:0)/(t=n.data.length)-1/t)?t:0)<1?t:1,N.type.R(n)&&(t*=.9),t},get:function(n){for(var t,r,e,n=N.asDb(n),i=n.head,u=n.body,o=[],a=0,f=i.length;a<f;++a)t=i[a],r=u.map(s),(e=["R","O","N","C"].map(c)).sort(h),o.push({key:t,types:Object.fromEntries(e),type:e[0][0]});return o;function s(n){return n[t]}function c(n){return[n,N.type[n]({data:r})]}function h(n,t){return t[1]-n[1]}},bind:function(r,e,n){var t,i,u,o,a,f,s,c,h,p,l,d,m,y;for(null==r&&(r=[]),null==e&&(e={}),n=n||N.type.get(r),(t=function(){var n,t=[];for(i in n=e)u=n[i],t.push({k:i,v:u});return t}().filter(function(n){return!n.v.passive})).sort(function(n,t){var r=(n.v.priority||100)-(t.v.priority||100);return 0!=r?r:(t=[n.v.type||"R",t.v.type||"R"].map(function(e){return Math.min.apply(Math,function(){for(var n=[],t=0,r=e.length;t<r;++t)n.push(t);return n}().map(function(n){return"CONRI".indexOf(e[n])}))}))[0]-t[1]}),o=0,a=t.length;o<a;++o)for((f=t[o]).bind=null,c=0,h=(s=f.v.type||"RINOC").length;c<h;++c){for(p=s[c],n.sort(_),l=0,d=n.length;l<d;++l)if(!(null==(m=n[l]).types[p]||m.types[p]<.5||m.used||"C"===p&&.5<m.types.R)){f.bind=f.v.multiple?[m]:m,m.used=!0;break}if(f.bind)break}for(o=0,a=t.length;o<a;++o)if((f=t[o]).v.multiple)for(c=0,h=(s=f.v.type||"RNOC").length;c<h;++c)for(p=s[c],n.sort(b),l=0,d=n.length;l<d;++l)null==(m=n[l]).types[p]||m.types[p]<.5||m.used||"C"===p&&.5<m.types.R||((f.bind||(f.bind=[])).push(m),m.used=!0);for(y={},o=0,a=t.length;o<a;++o)(f=t[o]).bind&&(y[f.k]=f.bind,(Array.isArray(f.bind)?f.bind:[f.bind]).map(g));return y;function _(n,t){var r=(t.types[p]||0)-(n.types[p]||0);return t.types[p]===n.types[p]&&"R"===p?(n.types.O||0)-(t.types.O||0):r}function b(n,t){var r=(t.types[p]||0)-(n.types[p]||0);return t.types[p]===n.types[p]&&"R"===p?(n.types.O||0)-(t.types.O||0):r}function g(n){var t;return r.unit&&(n.unit=r.unit[n.key]||""),t=n.used,delete n.used,t}}},N.sample={C:["books","business","education","entertainment","finance","food","games","health","lifestyle","medical","music","navigation","news","photography","productivity","social","network","sports","travel","utilities","weather"],N:["The Perfect Storm","Philadelphia Story","Planet of the Apes","Patton","Pocahontas","Pinoccio","Quills","Raiders of the Lost Ark","Romeo and Juliet","Snow White","Shine","Some Like It Hot","Stardust","Startrek","The Seven Year Itch","The Sound of Music","Sabrina","Sixth Sense","The Silence of the Lambs","Stargate","Sunset Boulevard","Superman"],generate:function(n){var i,t,r,e,u,o,a,f,s,c,h,p,l=n.count,d=n.binding,m=[{raw:[],binding:{}},0,l||10],y=m[0],_=m[1];for(t in l=m[2],i=i||{},d)r=d[t],e=(Array.isArray(r)?r:[r]).map(b),Array.isArray(r)?y.binding[t]=e.map(g):y.binding[t]={key:(m=i[e[0]]).key,name:m.name};for(u=Math.round(100*Math.random()),o=0;o<l;++o){for(t in a=o,f={},i)r=i[t],s=r.hint,c=function(){var n,t;switch(s.type){case"R":return h=s.range||[0,100],p=Math.random()*(h[1]-h[0])+h[0],h[1]-h[0]<1?p:Math.round(p);case"N":return N.sample.N[a%N.sample.N.length];case"C":return p=(n=null!=s.count?s.count:4<(n=Math.round(l/10))?n:4)<(t=N.sample.C.length)?n:t,N.sample.C[(s.random?Math.floor(Math.random()*l):a)%p];case"O":return Math.floor(a/(null!=s.repeat?s.repeat:1))+(null!=s.offset?s.offset:u);default:return"..."}}(),f[r.key]=c;y.raw.push(f)}return y;function b(n,t){var r=n.key||"field-"+_,e=n.name||r;return i[_]={key:r,name:e,hint:n},(_+=1)-1}function g(n){return{key:(n=i[n]).key,name:n.name}}}}}.call(this);
